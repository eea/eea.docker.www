apache:
  restart: always
  build: apache
  ports:
    - "80:80"
  volumes_from:
    - data
  links:
    - varnish

varnish:
  restart: always
  image: eeacms/varnish:3
  volumes_from:
    - data

memcached:
  restart: always
  image: eeacms/memcached
  ports:
    - "11211:11211"
  environment:
    - MEMCACHED_MEMORY=2048
    - MEMCACHED_PORT=11211

zeoserver:
  restart: always
  image: eeacms/zeoserver
  ports:
    - "8902:8100"
  volumes_from:
    - data
  environment:
    - INDEX=http://eggrepo.apps.eea.europa.eu/pypi/
    - FIND_LINKS=http://eggrepo.apps.eea.europa.eu/simple http://dist.plone.org/thirdparty/ http://pypi.python.org/pypi
    - BUILDOUT_EGGS=zc.async ZopeUndo

data:
  build: data
  volumes:
    - /var/local/www-logs/eea
    - /var/www-static-resources:/var/www-static-resources
    - /var/eea-buildout-plone4:/var/eea-buildout-plone4
    - /var/eea-buildout-plone4/etc/apache/vh-www-common.inc:/etc/httpd/conf.d/vh-www-common.inc
    - /var/eea-buildout-plone4/etc/apache/vh-www-staging.conf:/etc/httpd/conf.d/vh-www-staging.conf
    - /var/eea-buildout-plone4/etc/varnish/default-staging.vcl:/etc/varnish/conf.d/staging.vcl
    - /var/zodbfilestorage/plone4:/opt/zeoserver/var/filestorage
    - /var/sharedblobstorage/blobs:/opt/zeoserver/var/blobstorage
